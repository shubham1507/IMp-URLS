React.useEffect(() => {
    // 1) Read user object from localStorage
    try {
      const rawUser = window.localStorage.getItem("user");
      if (!rawUser) {
        console.warn("[UserPopover] localStorage.user not found");
        return;
      }

      const parsed = JSON.parse(rawUser);
      console.log("[UserPopover] localStorage.user =", parsed);

      // 2) Try to infer email: any string containing "@"
      let inferredEmail = "";
      for (const [key, value] of Object.entries(parsed)) {
        if (typeof value === "string" && value.includes("@")) {
          inferredEmail = value;
          break;
        }
      }

      // 3) Try to infer name:
      //    - prefer string with a space that is not an email
      //    - otherwise take any non-email string as a fallback
      let inferredName = "";
      for (const [key, value] of Object.entries(parsed)) {
        if (typeof value !== "string") continue;
        if (value.includes("@")) continue;

        const hasSpace = value.trim().includes(" ");
        if (hasSpace) {
          inferredName = value;
          break;
        }
        if (!inferredName) {
          inferredName = value; // fallback if nothing better
        }
      }

      setUser((prev) => ({
        ...prev,
        name: inferredName || prev.name,
        email: inferredEmail || prev.email,
      }));
    } catch (e) {
      console.error("[UserPopover] Failed to read localStorage.user", e);
    }
  }, []);