  React.useEffect(() => {
    const baseUrl = import.meta.env.VITE_API_GATEWAY_URL;
    if (!baseUrl) {
      console.error("VITE_API_GATEWAY_URL is not configured in .env");
      return;
    }

    // Read staff ID from localStorage "user" object
    let staffId = null;
    try {
      const rawUser = window.localStorage.getItem("user");
      if (rawUser) {
        const parsed = JSON.parse(rawUser);
        // adjust these field names if needed
        staffId =
          parsed.staff_id ||
          parsed.staffId ||
          parsed.qc_id ||
          parsed.qcid ||
          parsed.id; // fallback
      }
    } catch (e) {
      console.error("Failed to parse localStorage.user", e);
    }

    if (!staffId) {
      console.warn("No staff ID found in localStorage.user â€“ using default user.");
      return;
    }

    const controller = new AbortController();

    async function fetchProfile() {
      try {
        setLoading(true);

        const res = await fetch(
          `${baseUrl}/api/v1/users/${staffId}/profile`,
          {
            method: "GET",
            headers: { accept: "application/json" },
            signal: controller.signal,
          }
        );

        if (!res.ok) {
          console.error("Failed to fetch user profile", res.status);
          return;
        }

        const data = await res.json();

        setUser((prev) => ({
          ...prev,
          id: data?.staff_id ?? prev.id,
          name: data?.profile?.display_name ?? prev.name,
          email: data?.profile?.email ?? prev.email,
        }));
      } catch (err) {
        if (err.name !== "AbortError") {
          console.error("Error fetching user profile", err);
        }
      } finally {
        setLoading(false);
      }
    }

    fetchProfile();
    return () => controller.abort();
  }, []);
